
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mappool Admin Uploader (Public)</title>
  <style>
    body { font-family: Arial, sans-serif; background: #121212; color: #eee; padding: 20px; }
    input, select, button, textarea {
      background: #1e1e1e; color: #eee; border: 1px solid #444; padding: 8px; margin: 5px 0;
      width: 100%; max-width: 500px;
    }
    h1 { color: #66ccff; }
    label { display: block; margin-top: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #444; padding: 8px; }
    th { background-color: #222; }
    tr:nth-child(even) { background-color: #1a1a1a; }
    .container { max-width: 700px; margin: auto; }
    .btn { background-color: #66ccff; color: black; font-weight: bold; cursor: pointer; }
    .btn:hover { background-color: #3399cc; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mappool Admin Uploader (Public)</h1>

    <label>Mod</label>
    <select id="mod">
      <option value="NM">NoMod</option>
      <option value="HD">Hidden</option>
      <option value="HR">HardRock</option>
      <option value="DT">DoubleTime</option>
      <option value="FM">FreeMod</option>
      <option value="TB">Tiebreaker</option>
    </select>

    <label>Slot</label>
    <input type="text" id="slot" placeholder="e.g. NM1" />

    <label>Beatmap URL</label>
    <input type="text" id="url" placeholder="https://osu.ppy.sh/beatmapsets/...#osu/..." onblur="autofillFromURL()" />

    <label>Skill Type</label>
    <input type="text" id="skill" placeholder="e.g. Aim / Speed" />

    <label>Star Rating</label>
    <input type="text" id="stars" readonly />

    <label>CS (Circle Size)</label>
    <input type="text" id="cs" readonly />

    <label>AR (Approach Rate)</label>
    <input type="text" id="ar" readonly />

    <label>OD (Overall Difficulty)</label>
    <input type="text" id="od" readonly />

    <label>BPM</label>
    <input type="text" id="bpm" readonly />

    <button class="btn" onclick="addBeatmap()">âž• Add Beatmap</button>
    <button class="btn" onclick="downloadJSON()">ðŸ’¾ Download JSON</button>
    <input type="file" id="fileLoader" accept=".json" onchange="loadFile(event)" />

    <table id="previewTable">
      <thead>
        <tr><th>Mod</th><th>Slot</th><th>Skill</th><th>Stars</th><th>Title</th><th>Link</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let beatmaps = [];

    function extractBeatmapId(url) {
      const match = url.match(/osu\/(\d+)/);
      return match ? match[1] : null;
    }

    function autofillFromURL() {
      const url = document.getElementById('url').value;
      const beatmapId = extractBeatmapId(url);
      if (!beatmapId) return;

      fetch('https://osu-api-proxy.onrender.com/api/beatmap/'.replace('https://osu-api-proxy.onrender.com', 'https://osu-api-proxy.onrender.com') + beatmapId)
        .then(res => res.json())
        .then(data => {
          document.getElementById('title').value = data.title;
          document.getElementById('stars').value = data.stars;
          document.getElementById('cs').value = data.cs;
          document.getElementById('ar').value = data.ar;
          document.getElementById('od').value = data.od;
          document.getElementById('bpm').value = data.bpm;
        })
        .catch(err => {
          console.error("Error fetching beatmap:", err);
          alert("Couldn't fetch beatmap info from the URL.");
        });
    }

    function addBeatmap() {
      const mod = document.getElementById('mod').value;
      const slot = document.getElementById('slot').value;
      const skill = document.getElementById('skill').value;
      const stars = document.getElementById('stars').value;
      const cs = document.getElementById('cs').value;
      const ar = document.getElementById('ar').value;
      const od = document.getElementById('od').value;
      const bpm = document.getElementById('bpm').value;
      const title = document.getElementById('title').value;
      const url = document.getElementById('url').value;

      if (!mod || !slot || !skill || !stars || !title || !url) {
        alert("Please fill in all fields.");
        return;
      }

      const entry = { mod, slot, skill, stars, title, url, cs, ar, od, bpm };
      beatmaps.push(entry);
      renderTable();

      document.getElementById('slot').value = "";
      document.getElementById('skill').value = "";
      document.getElementById('stars').value = "";
      document.getElementById('cs').value = "";
      document.getElementById('ar').value = "";
      document.getElementById('od').value = "";
      document.getElementById('bpm').value = "";
      document.getElementById('title').value = "";
      document.getElementById('url').value = "";
    }

    function renderTable() {
      const tbody = document.querySelector("#previewTable tbody");
      tbody.innerHTML = "";
      beatmaps.forEach((map, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${map.mod}</td>
          <td>${map.slot}</td>
          <td>${map.skill}</td>
          <td>${map.stars}</td>
          <td>${map.title}</td>
          <td><a href="${map.url}" target="_blank">View</a></td>
        `;
        tbody.appendChild(row);
      });
    }

    function downloadJSON() {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(beatmaps, null, 2));
      const a = document.createElement('a');
      a.setAttribute("href", dataStr);
      a.setAttribute("download", "beatmaps.json");
      a.click();
    }

    function loadFile(event) {
      const reader = new FileReader();
      reader.onload = function() {
        try {
          beatmaps = JSON.parse(reader.result);
          renderTable();
        } catch (e) {
          alert("Invalid JSON file.");
        }
      };
      reader.readAsText(event.target.files[0]);
    }
  </script>
</body>
</html>
